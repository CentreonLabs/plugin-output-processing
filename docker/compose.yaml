services:

  pop:
    image: centreonlabs/pop
    container_name: pop-api
    ports:
      - 8000:8000
    environment:
      - POP_CONFIG_PATH=${POP_CONFIG_PATH:-/root/.pop/config.yaml}
      - OLLAMA_HOST=${OLLAMA_HOST:-ollama}
    volumes:
      - ./start_pop.sh:/root/start_pop.sh
      - pop:/root/.pop
    networks:
      - pop
    entrypoint: ["/root/start_pop.sh"]
    depends_on:
      - ollama
    command: ["uvicorn", "--host", "0.0.0.0", "--port", "8000", "--log-config", "log_conf.yaml", "plugin_output_processing.api:app"]

  ollama:
    container_name: pop-ollama
    image: ollama/ollama
    ports:
      - 11434:11434
    volumes:
      - ollama:/root/.ollama
    networks:
      - pop
    healthcheck:
      test: "ollama"
      interval: 1m30s
      timeout: 30s
      retries: 5
      start_period: 30s

volumes:
  pop:
  ollama:

networks:
  pop: